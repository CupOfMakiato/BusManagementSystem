@page
@model BusManagementSystem.Pages.Member.RegisterTicketModel
@{
    ViewData["Title"] = "Đăng Ký Vé Tháng";
}

<div class="register-ticket-wrapper">
    <div class="register-ticket-container">
        <h2>Đăng Ký Vé Tháng</h2>

        <form method="post" enctype="multipart/form-data">
            <div class="section">
                <h3>Thông Tin Người Dùng</h3>
                <div class="form-group">
                    <label>Họ Tên:</label>
                    <input type="text" class="form-control" value="@Model.User.Name" readonly />
                </div>

                <div class="form-group">
                    <label>Số Điện Thoại:</label>
                    <input type="text" class="form-control" value="@Model.User.PhoneNumber" readonly />
                </div>

                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" class="form-control" value="@Model.User.Email" readonly />
                </div>

                <div class="form-group">
                    <label>Ngày Sinh:</label>
                    <input type="text" class="form-control" value="@Model.User.DateOfBirth?.ToString("yyyy-MM-dd")" readonly />
                </div>
            </div>

            <div class="section">
                <h3>Chi Tiết Vé</h3>

                <div class="form-group">
                    <label>Ảnh Thẻ 3x4:</label>
                    <input type="file" name="Photo3x4" accept="image/*" class="form-control" required />
                </div>

                <div class="form-group">
                    <label>Loại Vé:</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="TicketType" value="Một tuyến" onchange="updatePrice()" required />
                            Một tuyến - 100,000 VND
                        </label>
                        <label>
                            <input type="radio" name="TicketType" value="Liên Tuyến" onchange="updatePrice()" />
                            Liên Tuyến - 200,000 VND
                        </label>
                    </div>
                </div>

                <div class="form-group" id="routeSelection" style="display: none;">
                    <label for="SelectedRouteId">Chọn Tuyến:</label>
                    <select id="SelectedRouteId" name="SelectedRouteId" class="form-control">
                        <option value="">-- Chọn Tuyến --</option>
                        @foreach (var route in Model.Routes)
                        {
                            <option value="@route.RouteId">@route.RouteName</option>
                        }
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="priority" name="IsPriority" onchange="updatePrice()" />
                        Ưu Tiên - Giảm giá 50%
                    </label>
                </div>

                <div class="form-group" id="priorityType" style="display: none;">
                    <label>Loại Ưu Tiên:</label>
                    <select id="PriorityType" name="PriorityType" class="form-control">
                        <option value="">-- Chọn Loại Ưu Tiên --</option>
                        <option value="Học Sinh, Sinh Viên">Học Sinh, Sinh Viên</option>
                        <option value="Công Nhân khu CN">Công Nhân khu CN</option>
                    </select>
                </div>

                <div class="form-group" id="studentWorkerIDUploads" style="display: none;">
                    <label>Thẻ Sinh Viên/Thẻ Công Nhân:</label>
                    <div class="form-group">
                        <label>Mặt Trước:</label>
                        <input type="file" name="IDCardFront" accept="image/*" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Mặt Sau:</label>
                        <input type="file" name="IDCardBack" accept="image/*" class="form-control" />
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Thời Gian Hiệu Lực Của Vé</h3>
                <div class="form-group">
                    <label>Ngày Bắt Đầu:</label>
                    <input type="text" class="form-control" value="@Model.StartDate.ToString("yyyy-MM-dd")" readonly />
                </div>

                <div class="form-group">
                    <label>Ngày Kết Thúc:</label>
                    <input type="text" class="form-control" value="@Model.EndDate.ToString("yyyy-MM-dd")" readonly />
                </div>

                <div class="form-group">
                    <label>Giá:</label>
                    <input type="text" id="CalculatedPrice" name="Price" class="form-control"
                           value="@(Model.CalculatedPrice.ToString("N0") + " VND")" readonly />
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Tiếp Tục Thanh Toán</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const priorityCheckbox = document.getElementById("priority");
        const priorityTypeDiv = document.getElementById("priorityType");
        const studentWorkerIDUploadsDiv = document.getElementById("studentWorkerIDUploads");

        function updatePriorityFields() {
            if (priorityCheckbox.checked) {
                priorityTypeDiv.style.display = "block";
                studentWorkerIDUploadsDiv.style.display = "block";
            } else {
                priorityTypeDiv.style.display = "none";
                studentWorkerIDUploadsDiv.style.display = "none";
            }
        }

        // Call function on page load
        updatePriorityFields();

        // Attach event listener to checkbox
        priorityCheckbox.addEventListener("change", updatePriorityFields);
    });
</script>
<script>
    function calculatePrice() {
        const ticketType = document.querySelector('input[name="TicketType"]:checked');
        const isPriority = document.getElementById("priority").checked;
        const calculatedPriceField = document.getElementById("CalculatedPrice");
        let calculatedPrice = 0;

        // Calculate base price based on ticket type
        if (ticketType) {
            if (ticketType.value === "Một tuyến") {
                calculatedPrice = 100000;
            } else if (ticketType.value === "Liên Tuyến") {
                calculatedPrice = 200000;
            }
        }

        // Apply discount if priority is selected
        if (isPriority) {
            calculatedPrice *= 0.5; // 50% discount
        }

        // Update the CalculatedPrice field with formatted price
        calculatedPriceField.value = calculatedPrice.toLocaleString() + " VND";
    }

    document.addEventListener("DOMContentLoaded", function () {
        // Attach event listeners
        document.getElementById("priority").addEventListener("change", calculatePrice);
        const ticketTypes = document.querySelectorAll('input[name="TicketType"]');
        ticketTypes.forEach((type) => type.addEventListener("change", calculatePrice));
    });
</script>